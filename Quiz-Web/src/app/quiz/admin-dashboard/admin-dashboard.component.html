<app-navbar></app-navbar>
<div class="container margin-top">
	<div class="row mb-2 margin-left-right">
		<button class="btn btn-pink btn-block" routerLink="/quiz/admin-dashboard/manage">
			<span class="font-weight-bold">Manage Quizzes</span>
		</button>
	</div>
	<div *ngIf="users">
		<mat-card>
			<div #testersTable>
				<div fxLayout fxLayoutAlign="start center" class="mb-2 ml-2 mt-xs">
					<mat-form-field fxFlex="100%" class="mr-1 mt-1">
						<input
							matInput
							type="text"
							placeholder="Search for tester"
							[(ngModel)]="filterText"
							(keyup)="applyFilter($event.target.value)"
						/>
						<button
							mat-icon-button
							matSuffix
							*ngIf="filterText"
							[attr.aria-label]="'Clear'"
							(click)="filterText = ''; applyFilter('')"
						>
							<mat-icon>close</mat-icon>
						</button>
					</mat-form-field>
				</div>
				<div *ngIf="isLoadingResults" class="loading-container"></div>
				<mat-card-title>
					<h5 class="user-name">Testers</h5>
					<span fxFlex></span>
					<a mat-icon-button title="export to excel" (click)="exportToExcel()">
						<span><i class="fa fa-file-excel-o" style="font-size: 25px"></i></span>
					</a>
					<a mat-icon-button title="print" (click)="print()">
						<mat-icon class="mat-24" aria-label="Example icon-button with a heart icon">print</mat-icon>
					</a>
				</mat-card-title>
				<table
					mat-table
					[dataSource]="users"
					matSort
					matSortActive="lastName"
					matSortDisableClear
					matSortDirection="asc"
				>
					<ng-container matColumnDef="lastName">
						<th mat-header-cell *matHeaderCellDef mat-sort-header><strong>Tester</strong></th>
						<td mat-cell *matCellDef="let element">
							<a class="user-link" [routerLink]="['/quiz/admin-dashboard/user-detail', element.userId]"
								>{{ element.firstName }} {{ element.lastName }}</a
							>
						</td>
					</ng-container>
					<ng-container matColumnDef="email">
						<th mat-header-cell *matHeaderCellDef mat-sort-header><strong>Email</strong></th>
						<td mat-cell *matCellDef="let element">
							{{ element.email }}
						</td>
					</ng-container>
					<ng-container matColumnDef="quizName">
						<th mat-header-cell *matHeaderCellDef mat-sort-header><strong>Quiz</strong></th>
						<td mat-cell *matCellDef="let element">
							{{ element.userAnswers[0]?.quizName }}
						</td>
					</ng-container>
					<ng-container matColumnDef="removeTester">
						<th mat-header-cell *matHeaderCellDef mat-sort-header></th>
						<td mat-cell *matCellDef="let element">
							<span mat-icon-button style="cursor: pointer">
								<i
									class="fa fa-trash-o pl-1"
									style="font-size:20px;color:red"
									(click)="openDeleteTesterDialog(element.userId)"
								></i>
							</span>
						</td>
					</ng-container>
					<tr mat-header-row *matHeaderRowDef="displayedUsersColumns"></tr>
					<tr mat-row *matRowDef="let row; columns: displayedUsersColumns"></tr>
				</table>
			</div>
			<mat-paginator [length]="resultsLength" [pageSize]="30"></mat-paginator>
		</mat-card>
	</div>
</div>
